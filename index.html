<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PecaShifter</title>

<style>

body{
  margin:0;
  font-family: system-ui, Arial;
  background: linear-gradient(160deg,#0f172a,#1e293b);
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}

.app{ width:100%; max-width:420px; padding:20px; }

.logo{
  font-size:34px;
  font-weight:900;
  text-align:center;
}

.sub{
  text-align:center;
  opacity:.7;
  margin-bottom:20px;
}

.card{
  background:#111827;
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.35);
}

#loading{
  text-align:center;
  opacity:.8;
}

/* switch */

.switch{
  display:flex;
  background:#1f2937;
  border-radius:12px;
  overflow:hidden;
  margin-bottom:14px;
}

.switch button{
  flex:1;
  padding:12px;
  border:none;
  font-weight:800;
  background:#374151;
  color:white;
  transition:.15s;
}

.switch button:hover{ background:#4b5563; }

.activeTab{
  background:#22c55e !important;
  color:black !important;
}

.switch button:active{
  transform:scale(.96);
}

/* inputs */

input{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
  font-size:16px;
}

/* main button */

.mainBtn{
  width:100%;
  padding:16px;
  border-radius:12px;
  border:none;
  font-size:16px;
  font-weight:900;
  background:#3b82f6;
  color:white;
  transition:.15s;
}

.mainBtn:hover{ background:#2563eb; }
.mainBtn:active{
  transform:scale(.97);
  filter:brightness(.85);
}

/* menu buttons */

.menu button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  margin-top:12px;
  font-weight:800;
  transition:.15s;
  color:white;
}

.btnEmployees{ background:#7c3aed; }
.btnGenerator{ background:#f59e0b; }
.btnSchedule{ background:#16a34a; }
.btnStats{ background:#06b6d4; }
.logout{ background:#374151; }

.menu button:hover{ filter:brightness(1.1); }
.menu button:active{
  transform:scale(.97);
  filter:brightness(.85);
}

.hidden{ display:none; }

.roleTag{
  text-align:center;
  margin-bottom:10px;
  opacity:.8;
}

</style>
</head>

<body>

<div class="app">

<div class="logo">PecaShifter</div>
<div class="sub">Smƒõnov√Ω pl√°novac√≠ syst√©m</div>

<!-- LOADING GATE -->
<div id="loading" class="card">
  Ovƒõ≈ôuji p≈ôihl√°≈°en√≠‚Ä¶
</div>

<!-- AUTH -->
<div id="authCard" class="card hidden">

  <div class="switch">
    <button id="tabLogin" class="activeTab" onclick="setMode('login')">P≈ôihl√°≈°en√≠</button>
    <button id="tabReg" onclick="setMode('register')">Registrace</button>
  </div>

  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Heslo">

  <button class="mainBtn" id="mainBtn" onclick="submitAuth()">
    P≈ôihl√°sit
  </button>

</div>

<!-- MENU -->
<div id="menuCard" class="card hidden">

  <div class="roleTag" id="roleLabel"></div>

  <div class="menu">

    <button class="btnEmployees adminOnly" onclick="go('employees.html')">
      üë• Karty zamƒõstnance
    </button>

    <button class="btnGenerator adminOnly" onclick="go('generator.html')">
      ‚öôÔ∏è Gener√°tor
    </button>

    <button class="btnSchedule" onclick="go('schedule.html')">
      üìä Smƒõnov√Ω graf
    </button>

    <button class="btnStats" onclick="go('stats.html')">
      üìà Statistiky
    </button>

    <button class="logout" onclick="logout()">
      Odhl√°sit
    </button>

  </div>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
  getFirestore,
  doc,
  getDoc,
  setDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAYJCwb7Gn73JJQ_iNqh1eweds8SJL6K2o",
  authDomain: "shifter-ee3e6.firebaseapp.com",
  projectId: "shifter-ee3e6",
  storageBucket: "shifter-ee3e6.firebasestorage.app",
  messagingSenderId: "288754692818",
  appId: "1:288754692818:web:e072935fe7a31152c5f30b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loading = document.getElementById("loading");
const emailEl = document.getElementById("email");
const passEl = document.getElementById("pass");
const authCard = document.getElementById("authCard");
const menuCard = document.getElementById("menuCard");
const roleLabel = document.getElementById("roleLabel");

let mode = "login";

window.setMode = (m)=>{
  mode = m;
  tabLogin.classList.toggle("activeTab", m==="login");
  tabReg.classList.toggle("activeTab", m==="register");
  mainBtn.innerText = m==="login" ? "P≈ôihl√°sit" : "Registrovat";
};

window.submitAuth = async ()=>{

  try{

    if(mode==="login"){
      await signInWithEmailAndPassword(auth,emailEl.value,passEl.value);
    }else{
      const cred = await createUserWithEmailAndPassword(auth,emailEl.value,passEl.value);
      await setDoc(doc(db,"users",cred.user.uid),{role:"user"});
      alert("Registrace probƒõhla");
      setMode("login");
    }

  }catch(e){

    if(
      e.code==="auth/user-not-found" ||
      e.code==="auth/wrong-password" ||
      e.code==="auth/invalid-credential"
    ){
      alert("Neplatn√© p≈ôihl√°≈°en√≠ ‚Äî √∫ƒçet neexistuje nebo ≈°patn√© heslo.");
    }
    else if(e.code==="auth/email-already-in-use"){
      alert("Tento email u≈æ je registrovan√Ω.");
    }
    else if(e.code==="auth/weak-password"){
      alert("Heslo mus√≠ m√≠t aspo≈à 6 znak≈Ø.");
    }
    else{
      alert("Registrace √∫spƒõ≈°n√°");
    }
  }
};

window.logout = ()=> signOut(auth);
window.go = (p)=> location.href=p;

onAuthStateChanged(auth, async user=>{

  loading.classList.add("hidden");

  if(!user){
    authCard.classList.remove("hidden");
    menuCard.classList.add("hidden");
    return;
  }

  const snap = await getDoc(doc(db,"users",user.uid));
  const role = snap.data()?.role || "user";

  roleLabel.innerText = "Role: "+role;

  if(role!=="admin"){
    document.querySelectorAll(".adminOnly")
      .forEach(b=>b.style.display="none");
  }

  authCard.classList.add("hidden");
  menuCard.classList.remove("hidden");

});

</script>

</body>
</html>
