<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zamƒõstnanci</title>

<style>

body{
  margin:0;
  font-family:system-ui, Arial;
  background:#0f172a;
  color:white;
}

.header{
  padding:16px;
  background:#020617;
  display:flex;
  gap:12px;
  align-items:center;
}

.back{
  background:#334155;
  border:none;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
}

.container{
  padding:16px;
  max-width:700px;
  margin:auto;
}

.addBtn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-weight:800;
  background:#22c55e;
  margin-bottom:16px;
}

.empRow{
  background:#111827;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.empName{
  font-weight:800;
  cursor:pointer;
}

select{
  padding:8px;
  border-radius:8px;
}

/* modal */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
}

.modalBox{
  background:#020617;
  margin:20px;
  padding:18px;
  border-radius:16px;
  max-height:90vh;
  overflow:auto;
}

input, textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

.skills{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.skillItem{
  background:#111827;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  border:2px solid transparent;
  font-size:13px;
  user-select:none;
}

.skillItem.active{
  border-color:#22c55e;
  background:#052e1b;
}

.modal button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:800;
  margin-top:8px;
}

.save{ background:#22c55e; }
.delete{ background:#ef4444; }
.close{ background:#334155; }

</style>
</head>

<body>

<div class="header">
  <button class="back" onclick="location.href='index.html'">‚¨Ö Menu</button>
  <h3>Zamƒõstnanci</h3>
</div>

<div class="container">
<button class="addBtn" onclick="openNew()">+ P≈ôidat zamƒõstnance</button>
<div id="list"></div>
</div>

<div id="modal" class="modal">
  <div class="modalBox">

    <input id="fName" placeholder="Jm√©no">
    <input id="lName" placeholder="P≈ô√≠jmen√≠">
    <textarea id="info" placeholder="Informace"></textarea>

    <h4>Pozice</h4>
    <div id="skillsBox" class="skills"></div>

    <h4>Stav dnes</h4>
    <select id="status">
      <option value="work">V pr√°ci</option>
      <option value="vacation">Dovolen√°</option>
      <option value="paragraf">Paragraf</option>
      <option value="sick">Nemoc</option>
      <option value="overtime">P≈ôesƒças</option>
    </select>

    <button class="save" onclick="saveEmp()">Ulo≈æit</button>
    <button class="delete" onclick="deleteEmp()">Smazat</button>
    <button class="close" onclick="closeModal()">Zav≈ô√≠t</button>

  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  getDocs,
  doc,
  setDoc,
  deleteDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyAYJCwb7Gn73JJQ_iNqh1eweds8SJL6K2o",
  authDomain: "shifter-ee3e6.firebaseapp.com",
  projectId: "shifter-ee3e6"
});

const auth = getAuth(app);
const db = getFirestore(app);

/* üîí mus√≠ b√Ωt p≈ôihl√°≈°en */

onAuthStateChanged(auth, u=>{
  if(!u){
    alert("Nejsi p≈ôihl√°≈°en");
    location.href="index.html";
  }
});

/* DOM */

const modal = document.getElementById("modal");
const skillsBox = document.getElementById("skillsBox");
const list = document.getElementById("list");

const fNameEl = document.getElementById("fName");
const lNameEl = document.getElementById("lName");
const infoEl = document.getElementById("info");
const statusEl = document.getElementById("status");

/* pozice */

const POSITIONS = [
["DP-L","DOORPROTECTOR L"],["DP-P","DOORPROTECTOR P"],
["ZRC-L","ZRC√ÅTKA L"],["ZRC-P","ZRC√ÅTKA P"],
["T-L","TƒöSNƒöN√ç L"],["T-P","TƒöSNƒöN√ç P"],
["AGR-LP","AGREG√ÅT LP"],["AGR-PP","AGREG√ÅT PP"],
["AGR-PZ","AGREG√ÅT PZ"],["AGR-LZ","AGREG√ÅT LZ"],
["MOT-L","MOTORY L"],["MOT-P","MOTORY P"],
["LEP-LP","LEPEN√ç LP"],["LEP-PP","LEPEN√ç PP"],
["LEP-Z","LEPEN√ç Z"],
["REPRO-L","REPR√ÅKY L"],["REPRO-P","REPR√ÅKY P"],
["VYP1-L","V√ùPLNƒö 1 L"],["VYP1-P","V√ùPLNƒö 1 P"],
["VYP2-L","V√ùPLNƒö 2 L"],["VYP2-P","V√ùPLNƒö 2 P"],
["PR-L","P≈òITAHOVAƒå L"],["PR-P","P≈òITAHOVAƒå P"],
["ZAM-L","Z√ÅMKY L"],["ZAM-P","Z√ÅMKY P"],
["VET","VƒöTRAƒåKY"],["INST","INSTALACE"]
];

POSITIONS.forEach(p=>{
  const div=document.createElement("div");
  div.className="skillItem";
  div.innerHTML=`<input type="checkbox" value="${p[0]}"> ${p[1]}`;
  div.onclick=()=>{
    const cb=div.querySelector("input");
    cb.checked=!cb.checked;
    div.classList.toggle("active",cb.checked);
  };
  skillsBox.appendChild(div);
});

let editId=null;

window.openNew=()=>{
  editId=null;
  fNameEl.value="";
  lNameEl.value="";
  infoEl.value="";
  statusEl.value="work";
  skillsBox.querySelectorAll("input").forEach(c=>{
    c.checked=false;
    c.parentElement.classList.remove("active");
  });
  modal.style.display="block";
};

window.closeModal=()=> modal.style.display="none";

/* SAVE */

window.saveEmp = async ()=>{

 try{

  if(!fNameEl.value || !lNameEl.value){
    alert("Vypl≈à jm√©no a p≈ô√≠jmen√≠");
    return;
  }

  const skills=[...skillsBox.querySelectorAll("input:checked")]
    .map(x=>x.value);

  const id = editId || (fNameEl.value+"_"+lNameEl.value)
    .toLowerCase().replace(/\s+/g,"_");

  await setDoc(doc(db,"employees",id),{
    name:fNameEl.value,
    surname:lNameEl.value,
    info:infoEl.value,
    skills,
    statusToday:statusEl.value
  });

  alert("Ulo≈æeno");
  modal.style.display="none";
  load();

 }catch(e){
  alert("CHYBA: "+e.message);
  console.error(e);
 }

};

/* DELETE */

window.deleteEmp = async ()=>{
 if(!editId) return;
 await deleteDoc(doc(db,"employees",editId));
 alert("Smaz√°no");
 modal.style.display="none";
 load();
};

/* LIST */

async function load(){
 list.innerHTML="";
 const snap = await getDocs(collection(db,"employees"));

 snap.forEach(d=>{
  const e=d.data();
  const row=document.createElement("div");
  row.className="empRow";
  row.innerHTML=`
   <div class="empName">${e.name} ${e.surname}</div>
   <select>
     <option value="work">Pr√°ce</option>
     <option value="vacation">Dovolen√°</option>
     <option value="paragraf">Paragraf</option>
     <option value="sick">Nemoc</option>
     <option value="overtime">P≈ôesƒças</option>
   </select>
  `;

  row.querySelector(".empName").onclick=()=>edit(d.id);
  const sel=row.querySelector("select");
  sel.value=e.statusToday||"work";
  sel.onchange=ev=>{
    setDoc(doc(db,"employees",d.id),
      {statusToday:ev.target.value},{merge:true});
  };

  list.appendChild(row);
 });
}

async function edit(id){
 const snap=await getDoc(doc(db,"employees",id));
 const e=snap.data();
 editId=id;
 modal.style.display="block";
 fNameEl.value=e.name;
 lNameEl.value=e.surname;
 infoEl.value=e.info;
 statusEl.value=e.statusToday||"work";
 skillsBox.querySelectorAll("input").forEach(c=>{
   c.checked=e.skills?.includes(c.value);
   c.parentElement.classList.toggle("active",c.checked);
 });
}

load();

</script>

</body>
</html>
