<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zaměstnanci</title>

<style>

body{
  margin:0;
  font-family:system-ui, Arial;
  background:#0f172a;
  color:white;
}

.header{
  padding:16px;
  background:#020617;
  display:flex;
  gap:12px;
  align-items:center;
}

.back{
  background:#334155;
  border:none;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
}

.container{
  padding:16px;
  max-width:700px;
  margin:auto;
}

.addBtn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-weight:800;
  background:#22c55e;
  margin-bottom:16px;
}

.empRow{
  background:#111827;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.empName{
  font-weight:800;
  cursor:pointer;
}

select{
  padding:8px;
  border-radius:8px;
}

/* modal */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
}

.modalBox{
  background:#020617;
  margin:20px;
  padding:18px;
  border-radius:16px;
  max-height:90vh;
  overflow:auto;
}

input, textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

.skills{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.skillItem{
  background:#111827;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  border:2px solid transparent;
  font-size:13px;
  user-select:none;
}

.skillItem.active{
  border-color:#22c55e;
  background:#052e1b;
}

.skillItem input{
  margin-right:6px;
}


.modal button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:800;
  margin-top:8px;
}

.save{ background:#22c55e; }
.delete{ background:#ef4444; }
.close{ background:#334155; }

</style>
</head>

<body>

<div class="header">
  <button class="back" onclick="location.href='index.html'">⬅ Menu</button>
  <h3>Zaměstnanci</h3>
</div>

<div class="container">

<button class="addBtn" onclick="openNew()">+ Přidat zaměstnance</button>

<div id="list"></div>

</div>

<!-- MODAL -->

<div id="modal" class="modal">
  <div class="modalBox">

    <input id="fName" placeholder="Jméno">
    <input id="lName" placeholder="Příjmení">
    <textarea id="info" placeholder="Informace"></textarea>

    <h4>Pozice</h4>
    <div id="skillsBox" class="skills"></div>

    <h4>Stav dnes</h4>
    <select id="status">
      <option value="work">V práci</option>
      <option value="vacation">Dovolená</option>
      <option value="paragraf">Paragraf</option>
      <option value="sick">Nemoc</option>
      <option value="overtime">Přesčas z jiné směny</option>
    </select>

    <button class="save" onclick="saveEmp()">Uložit</button>
    <button class="delete" onclick="deleteEmp()">Smazat</button>
    <button class="close" onclick="closeModal()">Zavřít</button>

  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  setDoc,
  deleteDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAYJCwb7Gn73JJQ_iNqh1eweds8SJL6K2o",
  authDomain: "shifter-ee3e6.firebaseapp.com",
  projectId: "shifter-ee3e6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* DOM refs — KRITICKÉ */

const modal = document.getElementById("modal");
const skillsBox = document.getElementById("skillsBox");
const list = document.getElementById("list");

const fNameEl = document.getElementById("fName");
const lNameEl = document.getElementById("lName");
const infoEl = document.getElementById("info");
const statusEl = document.getElementById("status");

/* positions */

const POSITIONS = [
["DP-L","DOORPROTECTOR L"],["DP-P","DOORPROTECTOR P"],
["ZRC-L","ZRCÁTKA L"],["ZRC-P","ZRCÁTKA P"],
["T-L","TĚSNĚNÍ L"],["T-P","TĚSNĚNÍ P"],
["AGR-LP","AGREGÁT LP"],["AGR-PP","AGREGÁT PP"],
["AGR-PZ","AGREGÁT PZ"],["AGR-LZ","AGREGÁT LZ"],
["MOT-L","MOTORY L"],["MOT-P","MOTORY P"],
["LEP-LP","LEPENÍ LP"],["LEP-PP","LEPENÍ PP"],
["LEP-Z","LEPENÍ Z"],
["REPRO-L","REPRÁKY L"],["REPRO-P","REPRÁKY P"],
["VYP1-L","VÝPLNĚ 1 L"],["VYP1-P","VÝPLNĚ 1 P"],
["VYP2-L","VÝPLNĚ 2 L"],["VYP2-P","VÝPLNĚ 2 P"],
["PR-L","PŘITAHOVAČ L"],["PR-P","PŘITAHOVAČ P"],
["ZAM-L","ZÁMKY L"],["ZAM-P","ZÁMKY P"],
["VET","VĚTRAČKY"],["INST","INSTALACE"]
];

let editId = null;

/* skills render */

POSITIONS.forEach(p=>{
  const div = document.createElement("div");
  div.className = "skillItem";
  div.innerHTML = `<input type="checkbox" value="${p[0]}"> ${p[1]}`;

  div.onclick = (e)=>{
    if(e.target.tagName !== "INPUT"){
      const cb = div.querySelector("input");
      cb.checked = !cb.checked;
    }
    div.classList.toggle("active", div.querySelector("input").checked);
  };

  skillsBox.appendChild(div);
});

/* ===== ACTIONS ===== */

window.openNew = ()=>{
  editId=null;
  fNameEl.value="";
  lNameEl.value="";
  infoEl.value="";
  statusEl.value="work";

  skillsBox.querySelectorAll("input").forEach(c=>{
    c.checked=false;
    c.parentElement.classList.remove("active");
  });

  modal.style.display="block";
};

window.closeModal = ()=> modal.style.display="none";

/* SAVE */

window.saveEmp = async ()=>{

  if(!fNameEl.value || !lNameEl.value){
    alert("Vyplň jméno a příjmení");
    return;
  }

  const skills = [...skillsBox.querySelectorAll("input:checked")]
    .map(x=>x.value);

  const id = editId || (fNameEl.value+"_"+lNameEl.value)
    .toLowerCase().replace(/\s+/g,"_");

  await setDoc(doc(db,"employees",id),{
    name:fNameEl.value,
    surname:lNameEl.value,
    info:infoEl.value,
    skills,
    statusToday:statusEl.value
  });

  modal.style.display="none";
  load();
};

/* DELETE */

window.deleteEmp = async ()=>{
  if(!editId) return;
  await deleteDoc(doc(db,"employees",editId));
  modal.style.display="none";
  load();
};

/* LIST */

async function load(){
  list.innerHTML="";
  const snap = await getDocs(collection(db,"employees"));

  snap.forEach(d=>{
    const e = d.data();

    const row = document.createElement("div");
    row.className="empRow";

    row.innerHTML = `
      <div class="empName">${e.name} ${e.surname}</div>
      <select>
        <option value="work">Práce</option>
        <option value="vacation">Dovolená</option>
        <option value="paragraf">Paragraf</option>
        <option value="sick">Nemoc</option>
        <option value="overtime">Přesčas</option>
      </select>
    `;

    row.querySelector(".empName").onclick = ()=> edit(d.id);
    row.querySelector("select").value = e.statusToday || "work";

    row.querySelector("select").onchange = async (ev)=>{
      await setDoc(doc(db,"employees",d.id),
        {statusToday:ev.target.value},
        {merge:true});
    };

    list.appendChild(row);
  });
}

/* EDIT */

async function edit(id){
  const snap = await getDoc(doc(db,"employees",id));
  const e = snap.data();

  editId=id;
  modal.style.display="block";

  fNameEl.value=e.name;
  lNameEl.value=e.surname;
  infoEl.value=e.info;
  statusEl.value=e.statusToday || "work";

  skillsBox.querySelectorAll("input").forEach(c=>{
    c.checked = e.skills?.includes(c.value);
    c.parentElement.classList.toggle("active", c.checked);
  });
}

load();

</script>



</body>
</html>
