<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zam캩stnanci</title>

<style>

body{
  margin:0;
  font-family:system-ui, Arial;
  background:#0f172a;
  color:white;
}

.header{
  padding:16px;
  background:#020617;
  display:flex;
  gap:12px;
  align-items:center;
}

.back{
  background:#334155;
  border:none;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
}

.container{
  padding:16px;
  max-width:700px;
  margin:auto;
}

.addBtn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-weight:800;
  background:#22c55e;
  margin-bottom:16px;
}

.empRow{
  background:#111827;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.empName{
  font-weight:800;
  cursor:pointer;
}

select{
  padding:8px;
  border-radius:8px;
}

/* modal */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
}

.modalBox{
  background:#020617;
  margin:20px;
  padding:18px;
  border-radius:16px;
  max-height:90vh;
  overflow:auto;
}

input, textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

.skills{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.skillItem{
  background:#111827;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  border:2px solid transparent;
  font-size:13px;
  user-select:none;
}

.skillItem.active{
  border-color:#22c55e;
  background:#052e1b;
}
.status-work{
  background:#16a34a;
  color:white;
}

.status-vacation{
  background:#f59e0b;
  color:black;
}

.status-sick,
.status-paragraf{
  background:#dc2626;
  color:white;
}

.status-shitmaking{
  background:#2563eb;
  color:white;
}

.status-borrowed{
  background:#a855f7;
  color:white;
}

.status-loaned{
  background:#14b8a6;
  color:black;
}


.topbar{
  height:56px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  background:#020617;
  border-bottom:1px solid #1f2937;
}

.topTitle{
  font-weight:800;
  font-size:18px;
}

.menuBtn{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  font-weight:800;
  background:#334155;
  color:white;
  cursor:pointer;
}

.menuBtn:hover{
  filter:brightness(1.15);
}

.menuBtn:active{
  transform:scale(.96);
}

.modal button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:800;
  margin-top:8px;
}

.save{ background:#22c55e; }
.delete{ background:#ef4444; }
.close{ background:#334155; }

</style>
</head>

<body>

<div class="topbar">
  <div class="topTitle">游논 Zam캩stnanci</div>
  <button class="menuBtn" onclick="location.href='index.html'">
    Menu
  </button>
</div>

<div class="container">
<button class="addBtn" onclick="openNew()">+ P콏idat zam캩stnance</button>
<button class="addBtn" style="background:#0ea5e9" onclick="openBroadcast()">
游닉 Hromadn치 zpr치va v코em
</button>
<div id="list"></div>
</div>

<div id="modal" class="modal">
  <div class="modalBox">

    <input id="fName" placeholder="Jm칠no">
    <input id="lName" placeholder="P콏칤jmen칤">
    <input id="email" placeholder="Email zam캩stnance">
    <textarea id="info" placeholder="Pozn치mka"></textarea>

    <h4>Pozice</h4>
    <div id="skillsBox" class="skills"></div>

    <h4>Stav dnes</h4>
    <select id="status">
  <option value="work">V pr치ci</option>
  <option value="vacation">Dovolen치</option>
  <option value="paragraf">Paragraf</option>
  <option value="sick">Nemoc</option>
  <option value="shitmaking">Shit making</option>
  <option value="borrowed">P콢j캜en칳</option>
  <option value="loaned">Prop콢j캜en칳</option>
</select>


    <button class="save" onclick="saveEmp()">Ulo쬴t</button>
    <button class="delete" onclick="deleteEmp()">Smazat</button>
    <button class="close" onclick="closeModal()">Zav콏칤t</button>

  </div>
</div>
</div>
<div id="broadcastModal" class="modal">
  <div class="modalBox">
    <h3>游닉 Hromadn치 zpr치va</h3>
    <textarea id="broadcastText" placeholder="Text pro v코echny zam캩stnance"></textarea>
    <button class="save" onclick="saveBroadcast()">Ulo쬴t zpr치vu</button>
    <button class="close" onclick="closeBroadcast()">Zav콏칤t</button>
  </div>
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  getDocs,
  doc,
  setDoc,
  deleteDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyAYJCwb7Gn73JJQ_iNqh1eweds8SJL6K2o",
  authDomain: "shifter-ee3e6.firebaseapp.com",
  projectId: "shifter-ee3e6"
});

const auth = getAuth(app);
const db = getFirestore(app);

/* 游 mus칤 b칳t p콏ihl치코en */

onAuthStateChanged(auth, u=>{
  if(!u){
    alert("Nejsi p콏ihl치코en");
    location.href="index.html";
  }
});

/* DOM */

const modal = document.getElementById("modal");
const skillsBox = document.getElementById("skillsBox");
const list = document.getElementById("list");

const fNameEl = document.getElementById("fName");
const lNameEl = document.getElementById("lName");
const emailEl = document.getElementById("email");
const infoEl = document.getElementById("info");
const statusEl = document.getElementById("status");
const broadcastModal = document.getElementById("broadcastModal");
const broadcastTextEl = document.getElementById("broadcastText");

/* pozice */

const POSITIONS = [
["DP-L","DOORPROTECTOR L"],["DP-P","DOORPROTECTOR P"],
["ZRC-L","ZRC츼TKA L"],["ZRC-P","ZRC츼TKA P"],
["T-L","T캨SN캨N칈 L"],["T-P","T캨SN캨N칈 P"],
["AGR-LP","AGREG츼T LP"],["AGR-PP","AGREG츼T PP"],
["AGR-PZ","AGREG츼T PZ"],["AGR-LZ","AGREG츼T LZ"],
["MOT-L","MOTORY L"],["MOT-P","MOTORY P"],
["LEP-LP","LEPEN칈 LP"],["LEP-PP","LEPEN칈 PP"],
["LEP-Z","LEPEN칈 Z"],
["REPRO-L","REPR츼KY L"],["REPRO-P","REPR츼KY P"],
["VYP1-L","V칗PLN캨 1 L"],["VYP1-P","V칗PLN캨 1 P"],
["VYP2-L","V칗PLN캨 2 L"],["VYP2-P","V칗PLN캨 2 P"],
["PR-L","P콎ITAHOVA캛 L"],["PR-P","P콎ITAHOVA캛 P"],
["ZAM-L","Z츼MKY L"],["ZAM-P","Z츼MKY P"],
["VET","V캨TRA캛KY"],["VET2","V캨TRA캛KY 2"],["INST","INSTALACE"],["INST2","INSTALACE 2"],
["JINE","JIN칗 칔SEK"],["JINE2","JIN칗 칔SEK 2"],

];

POSITIONS.forEach(p=>{
  const div=document.createElement("div");
  div.className="skillItem";
  div.innerHTML=`<input type="checkbox" value="${p[0]}"> ${p[1]}`;
  div.onclick=()=>{
    const cb=div.querySelector("input");
    cb.checked=!cb.checked;
    div.classList.toggle("active",cb.checked);
  };
  skillsBox.appendChild(div);
});

let editId=null;

window.openNew=()=>{
  editId=null;
  fNameEl.value="";
  lNameEl.value="";
  emailEl.value="";
  infoEl.value="";
  statusEl.value="work";
  skillsBox.querySelectorAll("input").forEach(c=>{
    c.checked=false;
    c.parentElement.classList.remove("active");
  });
  modal.style.display="block";
};

window.closeModal=()=> modal.style.display="none";

/* SAVE */

window.saveEmp = async ()=>{

 try{

  if(!fNameEl.value || !lNameEl.value){
    alert("Vypl켿 jm칠no a p콏칤jmen칤");
    return;
  }

  const skills=[...skillsBox.querySelectorAll("input:checked")]
    .map(x=>x.value);

  const id = editId || (fNameEl.value+"_"+lNameEl.value)
    .toLowerCase().replace(/\s+/g,"_");

  await setDoc(doc(db,"employees",id),{
  name:fNameEl.value,
  surname:lNameEl.value,
  email:emailEl.value.toLowerCase().trim(),
  info:infoEl.value,
  skills,
  statusToday:statusEl.value
});


  alert("Ulo쬰no");
  modal.style.display="none";
  load();

 }catch(e){
  alert("CHYBA: "+e.message);
  console.error(e);
 }

};

/* DELETE */

window.deleteEmp = async ()=>{

 if(!editId) return;

 const ok = confirm("Opravdu chce코 smazat z치znam zam캩stnance?");

 if(!ok) return;

 await deleteDoc(doc(db,"employees",editId));

 alert("Smaz치no");
 modal.style.display="none";
 load();
};

function paintStatusSelect(sel){

 sel.classList.remove(
  "status-work",
  "status-vacation",
  "status-sick",
  "status-paragraf",
  "status-shitmaking",
  "status-borrowed",
  "status-loaned"
 );


  sel.classList.add("status-" + sel.value);
}

/* LIST */

async function load(){
 list.innerHTML="";
 const snap = await getDocs(collection(db,"employees"));

 snap.forEach(d=>{
  const e=d.data();
  const row=document.createElement("div");
  row.className="empRow";
  row.innerHTML=`
   <div class="empName">${e.name} ${e.surname}</div>
   <select>
  <option value="work">Pr치ce</option>
  <option value="vacation">Dovolen치</option>
  <option value="paragraf">Paragraf</option>
  <option value="sick">Nemoc</option>
  <option value="shitmaking">Shit making</option>
  <option value="borrowed">P콢j캜en칳</option>
  <option value="loaned">Prop콢j캜en칳</option>
</select>
`;

  row.querySelector(".empName").onclick=()=>edit(d.id);
  const sel=row.querySelector("select");
  sel.value=e.statusToday || "work";
  paintStatusSelect(sel);
  sel.onchange=ev=>{
  paintStatusSelect(ev.target);
  setDoc(doc(db,"employees",d.id),
    {statusToday:ev.target.value},{merge:true});
};


  list.appendChild(row);
 });
}

async function edit(id){
 const snap=await getDoc(doc(db,"employees",id));
 const e=snap.data();
 editId=id;
 modal.style.display="block";
 fNameEl.value=e.name;
 lNameEl.value=e.surname;
 emailEl.value = e.email || "";
 infoEl.value=e.info;
 statusEl.value=e.statusToday||"work";
 skillsBox.querySelectorAll("input").forEach(c=>{
   c.checked=e.skills?.includes(c.value);
   c.parentElement.classList.toggle("active",c.checked);
 });
}

load();

window.openBroadcast = async ()=>{

 const snap = await getDoc(doc(db,"config","global"));
 broadcastTextEl.value = snap.data()?.broadcastMessage || "";
 broadcastModal.style.display = "block";
};

window.closeBroadcast = ()=> broadcastModal.style.display="none";

window.saveBroadcast = async ()=>{

 await setDoc(doc(db,"config","global"),{
   broadcastMessage: broadcastTextEl.value
 },{merge:true});

 alert("Ulo쬰no pro v코echny");
 broadcastModal.style.display="none";
};

</script>
</body>
</html>
